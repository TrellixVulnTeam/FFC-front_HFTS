{"ast":null,"code":"import _objectSpread from\"C:/Users/maaya/ffc_finalpro/User_Interface/frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/maaya/ffc_finalpro/User_Interface/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _objectWithoutProperties from\"C:/Users/maaya/ffc_finalpro/User_Interface/frontend/node_modules/@babel/runtime/helpers/esm/objectWithoutProperties.js\";import _slicedToArray from\"C:/Users/maaya/ffc_finalpro/User_Interface/frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";var _excluded=[\"handleSubmit\"];import _regeneratorRuntime from\"C:\\\\Users\\\\maaya\\\\ffc_finalpro\\\\User_Interface\\\\frontend\\\\node_modules\\\\@babel\\\\runtime\\\\regenerator\\\\index.js\";import React,{useState}from\"react\";import{FormProvider,useForm}from\"react-hook-form\";import classNames from\"classnames\";import TextArea from\"../../core/form/text-area/TextArea\";import{createNotification}from\"../../../api/notifications\";import useAuth from\"../../../hooks/useAuth\";import{useQuery}from\"react-query\";import{getPatients}from\"../../../api/patients-api\";import Select from\"../../core/form/select/Select\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var CreateTicketForm=function CreateTicketForm(_ref){var onClose=_ref.onClose;var _useAuth=useAuth(),isUserDoctor=_useAuth.isUserDoctor;var _useQuery=useQuery(\"patients\",getPatients,{enabled:isUserDoctor}),data=_useQuery.data;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoading=_useState2[0],setIsLoading=_useState2[1];var _useForm=useForm(),handleSubmit=_useForm.handleSubmit,methods=_objectWithoutProperties(_useForm,_excluded);var _JSON$parse=JSON.parse(localStorage.getItem(\"user\")),_JSON$parse$createdBy=_JSON$parse.createdBy,createdBy=_JSON$parse$createdBy===void 0?\"\":_JSON$parse$createdBy;var onComplete=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(ticketForm){var content,patient;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setIsLoading(true);content=ticketForm.content,patient=ticketForm.patient;_context.prev=2;_context.next=5;return createNotification({content:content,userSendType:isUserDoctor?\"patient\":\"doctor\",sendToUserID:isUserDoctor?patient:createdBy});case 5:onClose();_context.next=10;break;case 8:_context.prev=8;_context.t0=_context[\"catch\"](2);case 10:_context.prev=10;setIsLoading(false);return _context.finish(10);case 13:case\"end\":return _context.stop();}}},_callee,null,[[2,8,10,13]]);}));return function onComplete(_x){return _ref2.apply(this,arguments);};}();var patientOptions=(data===null||data===void 0?void 0:data.map(function(p){return{value:p._id,label:p.fullName};}))||[];return/*#__PURE__*/_jsx(\"form\",{onSubmit:handleSubmit(onComplete),children:/*#__PURE__*/_jsxs(FormProvider,_objectSpread(_objectSpread({},methods),{},{children:[isUserDoctor&&/*#__PURE__*/_jsx(Select,{options:patientOptions,name:\"patient\",label:\"Select Patient\"}),/*#__PURE__*/_jsx(TextArea,{name:\"content\",label:\"Content\",rules:{required:\"Content is required\"}}),/*#__PURE__*/_jsx(\"div\",{className:\"separator my-5\"}),/*#__PURE__*/_jsxs(\"button\",{className:classNames({\"btn btn-primary w-100\":true}),type:\"submit\",children:[isLoading?\"Please Wait...\":\"Create\",/*#__PURE__*/_jsx(\"span\",{className:\"indicator-progress\",children:isLoading&&/*#__PURE__*/_jsx(\"span\",{className:\"spinner-border spinner-border-sm align-middle ms-2\"})})]})]}))});};export default CreateTicketForm;","map":{"version":3,"names":["React","useState","FormProvider","useForm","classNames","TextArea","createNotification","useAuth","useQuery","getPatients","Select","CreateTicketForm","onClose","isUserDoctor","enabled","data","isLoading","setIsLoading","handleSubmit","methods","JSON","parse","localStorage","getItem","createdBy","onComplete","ticketForm","content","patient","userSendType","sendToUserID","patientOptions","map","p","value","_id","label","fullName","required"],"sources":["C:/Users/maaya/ffc_finalpro/User_Interface/frontend/src/components/app/Tickets/CreateTicketForm.js"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport { FormProvider, useForm } from \"react-hook-form\";\r\nimport classNames from \"classnames\";\r\nimport TextArea from \"../../core/form/text-area/TextArea\";\r\nimport { createNotification } from \"../../../api/notifications\";\r\nimport useAuth from \"../../../hooks/useAuth\";\r\nimport { useQuery } from \"react-query\";\r\nimport { getPatients } from \"../../../api/patients-api\";\r\nimport Select from \"../../core/form/select/Select\";\r\n\r\nconst CreateTicketForm = ({ onClose }) => {\r\n  const { isUserDoctor } = useAuth();\r\n  const { data } = useQuery(\"patients\", getPatients, {\r\n    enabled: isUserDoctor,\r\n  });\r\n  const [isLoading, setIsLoading] = useState(false);\r\n  const { handleSubmit, ...methods } = useForm();\r\n  const { createdBy = \"\" } = JSON.parse(localStorage.getItem(\"user\"));\r\n  const onComplete = async (ticketForm) => {\r\n    setIsLoading(true);\r\n    const { content, patient } = ticketForm;\r\n    try {\r\n      await createNotification({\r\n        content,\r\n        userSendType: isUserDoctor ? \"patient\" : \"doctor\",\r\n        sendToUserID: isUserDoctor ? patient : createdBy,\r\n      });\r\n      onClose();\r\n    } catch (error) {\r\n    } finally {\r\n      setIsLoading(false);\r\n    }\r\n  };\r\n  const patientOptions =\r\n    data?.map((p) => ({\r\n      value: p._id,\r\n      label: p.fullName,\r\n    })) || [];\r\n\r\n  return (\r\n    <form onSubmit={handleSubmit(onComplete)}>\r\n      <FormProvider {...methods}>\r\n        {isUserDoctor && (\r\n          <Select\r\n            options={patientOptions}\r\n            name=\"patient\"\r\n            label=\"Select Patient\"\r\n          />\r\n        )}\r\n        <TextArea\r\n          name=\"content\"\r\n          label=\"Content\"\r\n          rules={{\r\n            required: \"Content is required\",\r\n          }}\r\n        />\r\n\r\n        <div className=\"separator my-5\" />\r\n        <button\r\n          className={classNames({\r\n            \"btn btn-primary w-100\": true,\r\n          })}\r\n          type=\"submit\"\r\n        >\r\n          {isLoading ? \"Please Wait...\" : \"Create\"}\r\n          <span className=\"indicator-progress\">\r\n            {isLoading && (\r\n              <span className=\"spinner-border spinner-border-sm align-middle ms-2\" />\r\n            )}\r\n          </span>\r\n        </button>\r\n      </FormProvider>\r\n    </form>\r\n  );\r\n};\r\n\r\nexport default CreateTicketForm;\r\n"],"mappings":"4uBAAA,MAAOA,CAAAA,KAAP,EAAgBC,QAAhB,KAAgC,OAAhC,CACA,OAASC,YAAT,CAAuBC,OAAvB,KAAsC,iBAAtC,CACA,MAAOC,CAAAA,UAAP,KAAuB,YAAvB,CACA,MAAOC,CAAAA,QAAP,KAAqB,oCAArB,CACA,OAASC,kBAAT,KAAmC,4BAAnC,CACA,MAAOC,CAAAA,OAAP,KAAoB,wBAApB,CACA,OAASC,QAAT,KAAyB,aAAzB,CACA,OAASC,WAAT,KAA4B,2BAA5B,CACA,MAAOC,CAAAA,MAAP,KAAmB,+BAAnB,C,wFAEA,GAAMC,CAAAA,gBAAgB,CAAG,QAAnBA,CAAAA,gBAAmB,MAAiB,IAAdC,CAAAA,OAAc,MAAdA,OAAc,CACxC,aAAyBL,OAAO,EAAhC,CAAQM,YAAR,UAAQA,YAAR,CACA,cAAiBL,QAAQ,CAAC,UAAD,CAAaC,WAAb,CAA0B,CACjDK,OAAO,CAAED,YADwC,CAA1B,CAAzB,CAAQE,IAAR,WAAQA,IAAR,CAGA,cAAkCd,QAAQ,CAAC,KAAD,CAA1C,wCAAOe,SAAP,eAAkBC,YAAlB,eACA,aAAqCd,OAAO,EAA5C,CAAQe,YAAR,UAAQA,YAAR,CAAyBC,OAAzB,8CACA,gBAA2BC,IAAI,CAACC,KAAL,CAAWC,YAAY,CAACC,OAAb,CAAqB,MAArB,CAAX,CAA3B,mCAAQC,SAAR,CAAQA,SAAR,gCAAoB,EAApB,uBACA,GAAMC,CAAAA,UAAU,2FAAG,iBAAOC,UAAP,sIACjBT,YAAY,CAAC,IAAD,CAAZ,CACQU,OAFS,CAEYD,UAFZ,CAETC,OAFS,CAEAC,OAFA,CAEYF,UAFZ,CAEAE,OAFA,uCAITtB,CAAAA,kBAAkB,CAAC,CACvBqB,OAAO,CAAPA,OADuB,CAEvBE,YAAY,CAAEhB,YAAY,CAAG,SAAH,CAAe,QAFlB,CAGvBiB,YAAY,CAAEjB,YAAY,CAAGe,OAAH,CAAaJ,SAHhB,CAAD,CAJT,QASfZ,OAAO,GATQ,wGAYfK,YAAY,CAAC,KAAD,CAAZ,CAZe,qGAAH,kBAAVQ,CAAAA,UAAU,6CAAhB,CAeA,GAAMM,CAAAA,cAAc,CAClB,CAAAhB,IAAI,OAAJ,EAAAA,IAAI,SAAJ,QAAAA,IAAI,CAAEiB,GAAN,CAAU,SAACC,CAAD,QAAQ,CAChBC,KAAK,CAAED,CAAC,CAACE,GADO,CAEhBC,KAAK,CAAEH,CAAC,CAACI,QAFO,CAAR,EAAV,IAGO,EAJT,CAMA,mBACE,aAAM,QAAQ,CAAEnB,YAAY,CAACO,UAAD,CAA5B,uBACE,MAAC,YAAD,gCAAkBN,OAAlB,gBACGN,YAAY,eACX,KAAC,MAAD,EACE,OAAO,CAAEkB,cADX,CAEE,IAAI,CAAC,SAFP,CAGE,KAAK,CAAC,gBAHR,EAFJ,cAQE,KAAC,QAAD,EACE,IAAI,CAAC,SADP,CAEE,KAAK,CAAC,SAFR,CAGE,KAAK,CAAE,CACLO,QAAQ,CAAE,qBADL,CAHT,EARF,cAgBE,YAAK,SAAS,CAAC,gBAAf,EAhBF,cAiBE,gBACE,SAAS,CAAElC,UAAU,CAAC,CACpB,wBAAyB,IADL,CAAD,CADvB,CAIE,IAAI,CAAC,QAJP,WAMGY,SAAS,CAAG,gBAAH,CAAsB,QANlC,cAOE,aAAM,SAAS,CAAC,oBAAhB,UACGA,SAAS,eACR,aAAM,SAAS,CAAC,oDAAhB,EAFJ,EAPF,GAjBF,IADF,EADF,CAmCD,CAhED,CAkEA,cAAeL,CAAAA,gBAAf"},"metadata":{},"sourceType":"module"}